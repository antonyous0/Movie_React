{"ast":null,"code":"import _defineProperty from\"C:/Users/79227/OneDrive/Desktop/react/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"C:/Users/79227/OneDrive/Desktop/react/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"C:/Users/79227/OneDrive/Desktop/react/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/79227/OneDrive/Desktop/react/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/79227/OneDrive/Desktop/react/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useCallback,useEffect,useState}from\"react\";import style from\"./MovieEditForm.module.css\";import{useOutletContext,useParams}from\"react-router-dom\";import{editMovie,getMovieById,getMovies}from\"../../Services/apiService\";import{HorizontalLine}from\"../HorizontalLine/HorizontalLine\";import{useNavigate}from\"react-router-dom\";import{NotificationManager}from\"react-notifications\";import{Input}from\"../Input/Input\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var labelsTemplate={title:\"Название фильма\",year:\"Год выпуска\",plot:\"Описание\",posterUrl:\"Укажите ссылку на обложку\",rate:\"Рейтинг\",actors:\"Укажите список актеров\",director:\"Режиссер\",genres:\"Укажите список жанров\",runtime:\"Укажите продолжительность\"};var placeholdersTemplate={title:\"Введите название фильма\",year:\"Введите год выпуска\",plot:\"Введите ...\",posterUrl:\"Введите ...\",rate:\"Задайте рейтинг\",actors:\"Введите актеров (через ,)\",director:\"Введите ...\",genres:\"Введите ...\",runtime:\"Введите продолжительность\"};var initMovieData={id:0,title:\"\",year:0,plot:\"\",posterUrl:\"\",rate:0,actors:\"\",genres:[],runtime:0,director:\"\"};export var MovieEditForm=function MovieEditForm(){var _useOutletContext=useOutletContext(),_useOutletContext2=_slicedToArray(_useOutletContext,2),setMovies=_useOutletContext2[0],movies=_useOutletContext2[1];var _useParams=useParams(),id=_useParams.id;var navigate=useNavigate();var _useState=useState(initMovieData),_useState2=_slicedToArray(_useState,2),movie=_useState2[0],setMovie=_useState2[1];useEffect(function(){getMovieById(Number(id)).then(function(response){if(!(\"rate\"in response))response.rate=0;setMovie(response);});},[]);var saveData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var newMovies;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return editMovie(movie);case 3:_context.next=5;return getMovies();case 5:newMovies=_context.sent;setMovies(newMovies);NotificationManager.success(\"\\uD83D\\uDE03\\uD83D\\uDE03\\uD83D\\uDE03\",\"Фильм отредактирован\");navigate(\"/movies/\".concat(id));_context.next=14;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);NotificationManager.error(\";(\",\"Ошибка при обновлении списка фильмов\");case 14:case\"end\":return _context.stop();}}},_callee,null,[[0,11]]);}));return function saveData(){return _ref.apply(this,arguments);};}();var handleChangeFor=useCallback(function(propertyName){return function(event){var newValue=event.target.value;if(propertyName===\"genres\"){newValue=newValue.split(\",\");}setMovie(function(movie){return _objectSpread(_objectSpread({},movie),{},_defineProperty({},propertyName,newValue));});};},[]);return/*#__PURE__*/_jsxs(\"form\",{className:style.form,children:[/*#__PURE__*/_jsx(\"div\",{className:style.title,children:\"\\u0420\\u0435\\u0434\\u0430\\u043A\\u0442\\u0438\\u0440\\u043E\\u0432\\u0430\\u043D\\u0438\\u0435\"}),/*#__PURE__*/_jsx(Input,{label:labelsTemplate.title,placeholder:placeholdersTemplate.title,value:movie===null||movie===void 0?void 0:movie.title,id:\"title\",onChange:handleChangeFor}),/*#__PURE__*/_jsx(Input,{label:labelsTemplate.year,placeholder:placeholdersTemplate.year,value:String(movie===null||movie===void 0?void 0:movie.year),id:\"year\",onChange:handleChangeFor}),/*#__PURE__*/_jsx(Input,{label:labelsTemplate.plot,placeholder:placeholdersTemplate.plot,value:movie===null||movie===void 0?void 0:movie.plot,id:\"plot\",onChange:handleChangeFor}),/*#__PURE__*/_jsx(Input,{label:labelsTemplate.posterUrl,placeholder:placeholdersTemplate.posterUrl,value:movie===null||movie===void 0?void 0:movie.posterUrl,id:\"posterUrl\",onChange:handleChangeFor}),/*#__PURE__*/_jsx(Input,{label:labelsTemplate.rate,placeholder:placeholdersTemplate.rate,value:String(movie===null||movie===void 0?void 0:movie.rate),id:\"rate\",onChange:handleChangeFor}),/*#__PURE__*/_jsx(Input,{label:labelsTemplate.actors,placeholder:placeholdersTemplate.actors,value:movie===null||movie===void 0?void 0:movie.actors,id:\"actors\",onChange:handleChangeFor}),/*#__PURE__*/_jsx(Input,{label:labelsTemplate.director,placeholder:placeholdersTemplate.director,value:movie===null||movie===void 0?void 0:movie.director,id:\"director\",onChange:handleChangeFor}),/*#__PURE__*/_jsx(Input,{label:labelsTemplate.genres,placeholder:placeholdersTemplate.genres,value:String(movie===null||movie===void 0?void 0:movie.genres),id:\"genres\",onChange:handleChangeFor}),/*#__PURE__*/_jsx(Input,{label:labelsTemplate.runtime,placeholder:placeholdersTemplate.runtime,value:String(movie===null||movie===void 0?void 0:movie.runtime),id:\"runtime\",onChange:handleChangeFor}),/*#__PURE__*/_jsx(HorizontalLine,{}),/*#__PURE__*/_jsxs(\"div\",{className:style.footer,children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:style.cancelButton,onClick:function onClick(){navigate(\"/movies/\".concat(id));},children:\"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:style.saveButton,onClick:saveData,children:\"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C\"})]})]});};","map":{"version":3,"names":["React","useCallback","useEffect","useState","style","useOutletContext","useParams","editMovie","getMovieById","getMovies","HorizontalLine","useNavigate","NotificationManager","Input","labelsTemplate","title","year","plot","posterUrl","rate","actors","director","genres","runtime","placeholdersTemplate","initMovieData","id","MovieEditForm","setMovies","movies","navigate","movie","setMovie","Number","then","response","saveData","newMovies","success","error","handleChangeFor","propertyName","event","newValue","target","value","split","form","String","footer","cancelButton","saveButton"],"sources":["C:/Users/79227/OneDrive/Desktop/react/src/components/MovieEditForm/MovieEditForm.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useState } from \"react\";\r\nimport style from \"./MovieEditForm.module.css\";\r\nimport { useOutletContext, useParams } from \"react-router-dom\";\r\nimport { editMovie, getMovieById, getMovies } from \"../../Services/apiService\";\r\nimport { MovieDetailsData } from \"../../types\";\r\nimport { HorizontalLine } from \"../HorizontalLine/HorizontalLine\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { NotificationManager } from \"react-notifications\";\r\nimport { Input } from \"../Input/Input\";\r\n\r\nconst labelsTemplate = {\r\n  title: \"Название фильма\",\r\n  year: \"Год выпуска\",\r\n  plot: \"Описание\",\r\n  posterUrl: \"Укажите ссылку на обложку\",\r\n  rate: \"Рейтинг\",\r\n  actors: \"Укажите список актеров\",\r\n  director: \"Режиссер\",\r\n  genres: \"Укажите список жанров\",\r\n  runtime: \"Укажите продолжительность\",\r\n};\r\n\r\nconst placeholdersTemplate = {\r\n  title: \"Введите название фильма\",\r\n  year: \"Введите год выпуска\",\r\n  plot: \"Введите ...\",\r\n  posterUrl: \"Введите ...\",\r\n  rate: \"Задайте рейтинг\",\r\n  actors: \"Введите актеров (через ,)\",\r\n  director: \"Введите ...\",\r\n  genres: \"Введите ...\",\r\n  runtime: \"Введите продолжительность\",\r\n};\r\n\r\nconst initMovieData = {\r\n  id: 0,\r\n  title: \"\",\r\n  year: 0,\r\n  plot: \"\",\r\n  posterUrl: \"\",\r\n  rate: 0,\r\n  actors: \"\",\r\n  genres: [],\r\n  runtime: 0,\r\n  director: \"\",\r\n};\r\n\r\nexport const MovieEditForm = () => {\r\n  const [setMovies, movies] = useOutletContext<any>();\r\n  const { id } = useParams();\r\n  const navigate = useNavigate();\r\n  const [movie, setMovie] = useState<MovieDetailsData>(initMovieData);\r\n\r\n  useEffect(() => {\r\n    getMovieById(Number(id)).then((response) => {\r\n      if (!(\"rate\" in response)) response.rate = 0;\r\n      setMovie(response);\r\n    });\r\n  }, []);\r\n\r\n  const saveData = async () => {\r\n    try {\r\n      await editMovie(movie);\r\n      const newMovies = await getMovies();\r\n      setMovies(newMovies);\r\n      NotificationManager.success(`😃😃😃`, \"Фильм отредактирован\");\r\n      navigate(`/movies/${id}`);\r\n    } catch (e) {\r\n      NotificationManager.error(`;(`, \"Ошибка при обновлении списка фильмов\");\r\n    }\r\n  };\r\n\r\n  const handleChangeFor = useCallback(\r\n    (propertyName: string) => (event: { target: { value: any } }) => {\r\n      let newValue = event.target.value;\r\n      if (propertyName === \"genres\") {\r\n        newValue = newValue.split(\",\");\r\n      }\r\n      setMovie((movie) => ({\r\n        ...movie,\r\n        [propertyName]: newValue,\r\n      }));\r\n    },\r\n    []\r\n  );\r\n\r\n  return (\r\n    <form className={style.form}>\r\n      <div className={style.title}>Редактирование</div>\r\n\r\n      <Input\r\n        label={labelsTemplate.title}\r\n        placeholder={placeholdersTemplate.title}\r\n        value={movie?.title}\r\n        id=\"title\"\r\n        onChange={handleChangeFor}\r\n      />\r\n\r\n      <Input\r\n        label={labelsTemplate.year}\r\n        placeholder={placeholdersTemplate.year}\r\n        value={String(movie?.year)}\r\n        id=\"year\"\r\n        onChange={handleChangeFor}\r\n      />\r\n\r\n      <Input\r\n        label={labelsTemplate.plot}\r\n        placeholder={placeholdersTemplate.plot}\r\n        value={movie?.plot}\r\n        id=\"plot\"\r\n        onChange={handleChangeFor}\r\n      />\r\n\r\n      <Input\r\n        label={labelsTemplate.posterUrl}\r\n        placeholder={placeholdersTemplate.posterUrl}\r\n        value={movie?.posterUrl}\r\n        id=\"posterUrl\"\r\n        onChange={handleChangeFor}\r\n      />\r\n\r\n      <Input\r\n        label={labelsTemplate.rate}\r\n        placeholder={placeholdersTemplate.rate}\r\n        value={String(movie?.rate)}\r\n        id=\"rate\"\r\n        onChange={handleChangeFor}\r\n      />\r\n\r\n      <Input\r\n        label={labelsTemplate.actors}\r\n        placeholder={placeholdersTemplate.actors}\r\n        value={movie?.actors}\r\n        id=\"actors\"\r\n        onChange={handleChangeFor}\r\n      />\r\n\r\n      <Input\r\n        label={labelsTemplate.director}\r\n        placeholder={placeholdersTemplate.director}\r\n        value={movie?.director}\r\n        id=\"director\"\r\n        onChange={handleChangeFor}\r\n      />\r\n\r\n      <Input\r\n        label={labelsTemplate.genres}\r\n        placeholder={placeholdersTemplate.genres}\r\n        value={String(movie?.genres)}\r\n        id=\"genres\"\r\n        onChange={handleChangeFor}\r\n      />\r\n\r\n      <Input\r\n        label={labelsTemplate.runtime}\r\n        placeholder={placeholdersTemplate.runtime}\r\n        value={String(movie?.runtime)}\r\n        id=\"runtime\"\r\n        onChange={handleChangeFor}\r\n      />\r\n\r\n      <HorizontalLine />\r\n\r\n      <div className={style.footer}>\r\n        <button\r\n          type=\"button\"\r\n          className={style.cancelButton}\r\n          onClick={() => {\r\n            navigate(`/movies/${id}`);\r\n          }}\r\n        >\r\n          Отменить\r\n        </button>\r\n        <button type=\"button\" className={style.saveButton} onClick={saveData}>\r\n          Сохранить\r\n        </button>\r\n      </div>\r\n    </form>\r\n  );\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}